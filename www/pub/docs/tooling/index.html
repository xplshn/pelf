<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="apple-mobile-web-app-title" content="ðŸ…®">
  <meta name="application-name" content="ðŸ…®">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

  <style>
    body{font-family:monospace;}
    html{cursor: url('http://localhost:1313/img/9cursor.png'), auto;}
  </style>

  <title>AppBundle Tooling: pelf and pelfCreator</title>
  
  
  <link rel="stylesheet" href="http://localhost:1313/css/style.css">
  
  <link rel="stylesheet" href="http://localhost:1313/css/theme_blue.css">

  

  
  <link href='http://localhost:1313/css/SerenityOS-Emoji.css' rel="stylesheet" type="text/css">
  <link href='http://localhost:1313/css/highlightjs_style.css' rel="stylesheet" type="text/css">
  
  <script src="http://localhost:1313/js/tex-mml-svg.js"></script>
  <script src="http://localhost:1313/js/highlight.min.js"></script>
  <script src="http://localhost:1313/js/highlight-basic.min.js"></script>
  <script src="http://localhost:1313/js/highlight-bash.min.js"></script>
  <script src="http://localhost:1313/js/highlight-go.min.js"></script>
  <script src="http://localhost:1313/js/highlight-c.min.js"></script>
  
  <script>
  (function() {
    function center_el(tagName) {
      var tags = document.getElementsByTagName(tagName), i, tag;
      for (i = 0; i < tags.length; i++) {
        tag = tags[i];
        var parent = tag.parentElement;
        
        if (parent.childNodes.length === 1) {
          
          if (parent.nodeName === 'A') {
            parent = parent.parentElement;
            if (parent.childNodes.length != 1) continue;
          }
          if (parent.nodeName === 'P') parent.style.textAlign = 'center';
        }
      }
    }
    var tagNames = ['img', 'embed', 'object'];
    for (var i = 0; i < tagNames.length; i++) {
      center_el(tagNames[i]);
    }
  })();
  </script>

  
  
  
  
  
  
  
  

</head>
<body>
  <header>
    <nav class="no-print">
    
    <div class="left">
      
    </div>
    <div class="right">
      <span class="doNotDisplay">Related sites:</span>
      |
      
        <a href="https://musl.libc.org">musl.libc.org</a> |
      
        <a href="https://web.archive.org/web/20231123031907/https://managainstthestate.blogspot.com/2011/08/anarcho-capitalist-resources-by-wesker.html">managainstthestate.blogspot.com</a> |
      
        <a href="https://shithub.us">shithub.us</a> |
      
        <a href="https://copacabana.pindorama.net.br">copacabana.pindorama.net.br</a> |
      
        <a href="https://suckless.org">suckless.org</a> |
      
        <a href="https://nosystemd.org">nosystemd.org</a> |
      
        <a href="https://harmful.cat-v.org">harmful.cat-v.org</a> |
      
        <a href="https://github.com/xplshn/dbin">dbin</a> |
      
        <a href="https://fatbuffalo.neocities.org/def">neoblog</a> |
      
        <a href="/index.xml">subscribe</a> |
      
    </div>
  </nav>
  <h1>
    <a href="http://localhost:1313/">ðŸ…®
      <span id="headerSubTitle">Labs</span>
    </a>
  </h1>
</header>

  
<nav id="side-bar" class="no-print">
<style>@media print {article {display: block;margin-left: auto;margin-right: auto;width: 100%;}}</style>

  <div>
    <ul>
    
    
      
        <li><a href="/" title="">&rsaquo; Home</a></li>
      
    
    
    
      
        <li><a href="http://localhost:1313/docs/" title="Documentation Index">&rsaquo; Documentation Index</a></li>
      
    
    </ul>
  </div>
</nav>


  <article id="main">
    
  <div class="article-meta">
    <h1><span class="title">AppBundle Tooling: pelf and pelfCreator</span></h1>
    
        <span class="author">
    <span class="author">
      by
      <a href="mailto:xplshn@murena.io">
        xplshn
      </a>
    </span>

</span>
        
            &ndash; <span class="date">2025/05/24</span>
        
    
    <p class="terms">
      
        
      
        
      
    </p>
  </div>
  
  <main>
    <h1 id="appbundle-tooling-pelf-and-pelfcreator">AppBundle Tooling: pelf and pelfCreator</h1>
<p>This document describes the <code>pelf</code> and <code>pelfCreator</code> tools, which are used to create and manage AppBundles, self-contained executable packages for Linux applications.</p>
<h2 id="pelf-tool">pelf Tool</h2>
<p>The <code>pelf</code> tool is responsible for assembling an AppBundle by combining an ELF runtime, runtime information, static tools, and a compressed filesystem image.</p>
<h3 id="functionality">Functionality</h3>
<ul>
<li><strong>Purpose</strong>: Creates an AppBundle from an AppDir, embedding necessary metadata and tools.</li>
<li><strong>Key Operations</strong>:
<ul>
<li>Reads an AppDir, verifies that it contains an executable AppRun</li>
<li>Copies the runtime to the output file</li>
<li>Embeds runtime information (MessagePack format) in the <code>.pbundle_runtime_info</code> section of the output file</li>
<li>If the runtime is a universal runtime (e.g: noEmbed edition), it puts a ZSTD-compressed tar archive of static tools (depending the chosen filesystem: e.g., <code>dwarfs</code>, <code>squashfuse</code>, <code>unsquashfs</code>) in the <code>.pbundle_static_tools</code> section of the output file.</li>
<li>Compresses the AppDir into a DwarFS or SquashFS filesystem image and appends it to the output file</li>
<li>Sets the AppBundle&rsquo;s executable permissions and finalizes the output file.</li>
</ul>
</li>
</ul>
<h3 id="command-line-usage">Command-Line Usage</h3>
<p>The pelf tool is can be invoked with the following flags:</p>
<ul>
<li><strong>&ndash;add-appdir, -a <path></strong>: Specifies the AppDir to package.</li>
<li><strong>&ndash;appbundle-id, -i <id></strong>: Sets the unique AppBundleID for the AppBundle.</li>
<li><strong>&ndash;output-to, -o <file></strong>: Specifies the output file name (e.g., app.dwfs.AppBundle).</li>
<li><strong>&ndash;compression, -c <flags></strong>: Specifies compression flags for the filesystem.</li>
<li><strong>&ndash;static-tools-dir <path></strong>: Specifies a custom directory for static tools.</li>
<li><strong>&ndash;runtime <path></strong>: Specifies the runtime binary to use.</li>
<li><strong>&ndash;upx</strong>: Enables UPX compression for static tools. (upx must be in the host system)</li>
<li><strong>&ndash;filesystem, -j <fs>:</strong> Selects the filesystem type (squashfs or [dwarfs]).</li>
<li><strong>&ndash;prefer-tools-in-path:</strong> Prefers tools in <code>$PATH</code> over embedded ones.</li>
<li><strong>&ndash;list-static-tools:</strong> Lists embedded tools with their B3SUMs.</li>
<li><strong>&ndash;disable-use-random-workdir, -d:</strong> Disables random working directory usage. This making AppBundles leave their mountpoint open and reusing it in each launch. This is ideal for big programs that need to launch ultra-fast, such as web browsers, messaging clients, etc</li>
<li><strong>&ndash;run-behavior, -b &lt;0|1|2|3&gt;:</strong> Sets runtime behavior (0: FUSE only, 1: Extract only, 2: FUSE with extract fallback, 3: FUSE with extract fallback if â‰¤ 350MB).</li>
<li><strong>&ndash;appimage-compat, -A:</strong> Sets the &ldquo;AI&rdquo; magic-bytes, so that AppBundles are detected as AppImages by AppImage integration software like <a href="https://github.com/AppImageCommunity/AppImageUpdate">AppImageUpdate</a></li>
<li><strong>&ndash;add-runtime-info-section <string>:</strong> Adds custom runtime information fields. (e.g: &lsquo;.MyCustomRuntimeInfoSection:Hello&rsquo;)</li>
<li><strong>&ndash;add-elf-section <path>:</strong> Adds a custom ELF section from a .elfS file., where the filename of the .elfS file minus the extension is the section name, and the file contents are the data</li>
<li><strong>&ndash;add-updinfo <string>:</strong> Adds an upd_info ELF section with the given string.</li>
</ul>
<h2 id="pelfcreator-tool">pelfCreator Tool</h2>
<p>The <code>pelfCreator</code> tool is a higher-level utility that prepares an AppDir and invokes <code>pelf</code> to create an AppBundle. It supports multiple modes for different use cases.</p>
<h3 id="functionality-1">Functionality</h3>
<ul>
<li><strong>Purpose</strong>: Creates an AppDir, populates it with a root filesystem, application files, and dependencies, and then packages it into an AppBundle.</li>
<li><strong>Key Operations</strong>:
<ul>
<li>Sets up a temporary directory for processing.</li>
<li>Downloads or uses a local root filesystem (e.g., Alpine or ArchLinux).</li>
<li>Installs specified packages using <code>apk</code> (Alpine) or <code>pacman</code> (ArchLinux).</li>
<li>Configures the AppRun script and entrypoint.</li>
<li>Optionally processes binaries with <code>lib4bin</code> for <code>sharun</code> mode.</li>
<li>Trims the filesystem based on <code>--keep</code> or <code>--getrid</code> flags.</li>
<li>Calls <code>pelf</code> to finalize the AppBundle.</li>
</ul>
</li>
</ul>
<h3 id="command-line-usage-1">Command-Line Usage</h3>
<p>The <code>pelfCreator</code> tool is invoked with the following flags:</p>
<ul>
<li><strong><code>--maintainer &lt;name&gt;</code></strong>: Specifies the maintainer&rsquo;s name (required).</li>
<li><strong><code>--name &lt;name&gt;</code></strong>: Sets the application name (required).</li>
<li><strong><code>--appbundle-id &lt;id&gt;</code></strong>: Sets the <code>AppBundleID</code> (optional; defaults to <code>&lt;name&gt;-&lt;date&gt;-&lt;maintainer&gt;</code>).</li>
<li><strong><code>--pkg-add &lt;packages&gt;</code></strong>: Specifies packages to install in the root filesystem (required).</li>
<li><strong><code>--entrypoint &lt;path&gt;</code></strong>: Sets the entrypoint command or desktop file (required unless using <code>--multicall</code>).</li>
<li><strong><code>--keep &lt;files&gt;</code></strong>: Specifies files to keep in the <code>proto</code> directory.</li>
<li><strong><code>--getrid &lt;files&gt;</code></strong>: Specifies files to remove from the <code>proto</code> directory.</li>
<li><strong><code>--filesystem &lt;fs&gt;</code></strong>: Selects the filesystem type (<code>dwfs</code> or <code>squashfs</code>; default: <code>dwfs</code>).</li>
<li><strong><code>--output-to &lt;file&gt;</code></strong>: Specifies the output AppBundle file (optional; defaults to <code>&lt;name&gt;.&lt;fs&gt;.AppBundle</code>).</li>
<li><strong><code>--local &lt;path&gt;</code></strong>: Specifies a directory or archive containing resources (e.g., <code>rootfs.tar</code>, <code>AppRun</code>, <code>bwrap</code>).</li>
<li><strong><code>--preserve-rootfs-permissions</code></strong>: Preserves original filesystem permissions.</li>
<li><strong><code>--dontpack</code></strong>: Stops short of packaging the AppDir into an AppBundle, leaving only the AppDir.</li>
<li><strong><code>--sharun &lt;binaries&gt;</code></strong>: Processes specified binaries with <code>lib4bin</code> and uses <code>AppRun.sharun</code> or <code>AppRun.sharun.ovfsProto</code>.</li>
<li><strong><code>--sandbox</code></strong>: Enables sandbox mode using <code>AppRun.rootfs-based</code> with <code>bwrap</code>.</li>
</ul>
<h3 id="modes-of-operation">Modes of Operation</h3>
<ol>
<li>
<p><strong>Sandbox Mode</strong> (<code>--sandbox</code>):</p>
<ul>
<li>Retains and binds the <code>proto</code> directory as the root filesystem, with host directory bindings (e.g., <code>/home</code>, <code>/tmp</code>, <code>/etc</code>).</li>
<li>Supports trimming of the <code>proto</code> directory using <code>--keep</code> or <code>--getrid</code> flags to reduce size.</li>
<li>Uses <code>AppRun.rootfs-based</code> to run the application in a <code>bwrap</code> sandbox.</li>
<li>Can be customized via env vars such as <code>SHARE_LOOK</code>, <code>SHARE_FONTS</code>, <code>SHARE_AUDIO</code>, and <code>UID0_GID0</code> for fine-grained control over sandboxing.</li>
<li>Suitable for applications requiring strict isolation from the host system. Or those that refuse to work with the default mode (hybrid)</li>
</ul>
</li>
<li>
<p><strong>Sharun Mode</strong> (<code>--sharun &lt;binaries&gt;</code>):</p>
<ul>
<li>Processes specified binaries with <code>lib4bin</code> to ensure compatibility and portability.</li>
<li>Uses <code>AppRun.sharun</code> (if <code>proto</code> is removed) or <code>AppRun.sharun.ovfsProto</code> (if <code>proto</code> is retained).</li>
<li>When using <code>AppRun.sharun.ovfsProto</code>, employs <code>unionfs-fuse</code> to create a copy-on-write overlay of the <code>proto</code> directory.</li>
<li>Sets <code>LD_LIBRARY_PATH</code> to include library paths from the AppDir, ensuring binaries can find their dependencies.</li>
<li>Ideal for lightweight applications or when minimizing filesystem size is a priority.</li>
</ul>
</li>
<li>
<p><strong>Default Mode</strong> (can be combined with <code>--sharun</code>, to ship lightweight AppBundles that include a default config file, etc, but otherwise use the system&rsquo;s files unless they&rsquo;re missing):</p>
<ul>
<li>Retains the <code>proto</code> directory</li>
<li>Supports trimming of the <code>proto</code> directory using <code>--keep</code> or <code>--getrid</code> flags to reduce size.</li>
<li>Uses <code>AppRun.sharun.ovfsProto</code> to execute the application with a <code>unionfs-fuse</code> overlay of the user&rsquo;s <code>/</code> &amp; the AppDir&rsquo;s <code>proto</code>.</li>
<li>Suitable for most applications, as it allows the AppBundle to use files from the system if they don&rsquo;t exist in the AppDir&rsquo;s <code>proto</code> and vice-versa</li>
</ul>
</li>
</ol>
<h2 id="notes">Notes</h2>
<ul>
<li>The <code>pelfCreator</code> tool supports extensibility through custom root filesystems and package managers via the <code>--local</code> flag.</li>
</ul>

  </main>

  </article>
  <footer class="no-print">
    <div class="pull-left">
        <a href="https://gohugo.io">Powered by Hugo.</a>
    </div>
    
    </div>
</footer>


  
  
  
  
  
  
</body>
</html>
